<div class="container mt-4 mb-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Unlock Transaksi</h2>
    <div>
      <!-- Input Filter Tanggal -->
      <input
        type="date"
        [(ngModel)]="filterDate"
        (ngModelChange)="onFilterDateChange()"
        class="me-2"
        style="padding: 0.375rem 0.75rem; border-radius: 0.375rem; border: 1px solid #ced4da;"
      />
      <button class="btn btn-primary me-2" (click)="addNewTransaction()">
        <i class="fas fa-plus"></i> Tambah Data
      </button>
      <button class="btn btn-outline-danger" (click)="logoutAdmin()">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>
    
  </div>

  <div *ngIf="isLoading" class="alert alert-info">
    Memuat data transaksi...
  </div>

  <div *ngIf="!isLoading && filteredTransactions.length === 0" class="alert alert-warning">
    Tidak ada data transaksi pada tanggal yang dipilih.
  </div>

  <div *ngIf="!isLoading && filteredTransactions.length > 0" class="table-responsive shadow-sm" style="max-height: 400px; overflow-y: auto;">
    <table class="table table-striped table-hover table-bordered">
      <thead class="table-dark">
        <tr class="align-middle">
          <th scope="col" style="position: sticky; top: 0; background: #212529; z-index: 10;">NIK</th>
          <th scope="col" style="position: sticky; top: 0; background: #212529; z-index: 10;">Nama Driver</th>
          <th scope="col" style="position: sticky; top: 0; background: #212529; z-index: 10;">Truck</th>
          <th scope="col" style="position: sticky; top: 0; background: #212529; z-index: 10;">Tangki</th>
          <th scope="col" style="position: sticky; top: 0; background: #212529; z-index: 10;">Tanggal</th>
          <th scope="col" style="position: sticky; top: 0; background: #212529; z-index: 10;">Mulai (PAS)</th>
          <th scope="col" style="position: sticky; top: 0; background: #212529; z-index: 10;">Tiba (PSG)</th>
          <th scope="col" style="position: sticky; top: 0; background: #212529; z-index: 10;">Mulai (PSG)</th>
          <th scope="col" style="position: sticky; top: 0; background: #212529; z-index: 10;">Tiba (PAS)</th>
          <th scope="col" class="text-center" style="position: sticky; top: 0; background: #212529; z-index: 10;">Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let trx of filteredTransactions">
          <td>{{ trx.nik || 'N/A' }}</td>
          <td>{{ trx.namaDriver || 'N/A' }}</td>
          <td>{{ trx.nomorPolisi || 'N/A' }}</td>
          <td>{{ trx.variantTangki || 'N/A' }}</td>
          <td>{{ trx.created_at ? formatDisplayDate(trx.created_at) : trx.id }}</td>
          <td>{{ trx.mulai_pas_to_psg || '-' }}</td>
          <td>{{ trx.tiba_pas_to_psg || '-' }}</td>
          <td>{{ trx.mulai_psg_to_pas || '-' }}</td>
          <td>{{ trx.tiba_psg_to_pas || '-' }}</td>
          <td>
            <div class="text-center">
              <div class="d-flex justify-content-center gap-1">
                <button *ngIf="trx.mulai_pas_to_psg == '-' || trx.tiba_pas_to_psg == '-'"
                        class="btn btn-info btn-sm"
                        (click)="copyLink(trx.id)"
                        title="Copy Link Transaksi (Masuk)">
                  <i class="fas fa-copy"></i>
                </button>

                <!-- Tombol Copy Link Pulang -->
                <button *ngIf="trx.mulai_psg_to_pas != '-' || trx.tiba_psg_to_pas != '-'"
                        class="btn btn-info btn-sm"
                        (click)="copyLinkPulang(trx.id)"
                        title="Copy Link Transaksi (Pulang)">
                  <i class="fas fa-copy"></i>
                </button>
                <button class="btn btn-warning btn-sm" (click)="unlockTransaction(trx)">
                  <i class="fas fa-unlock-alt"></i>
                </button>
                <!-- <button class="btn btn-danger btn-sm" (click)="deleteTransaction(trx)">
                  <i class="fas fa-trash-alt"></i>
                </button> -->
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>